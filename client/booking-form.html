<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Auto-mec Booking Form</title>
  <link rel="stylesheet" href="../shared/global.css" />
  <style>
    /* Inline tweaks if needed */
  </style>
</head>
<body>
  <!-- Header with Hamburger Menu -->
  <header class="header">
    <div>Auto-mec</div>
    <div class="menu-button" id="menuBtn" tabindex="0" aria-label="Toggle menu">&#9776;</div>
    <nav class="dropdown" id="dropdownMenu" aria-label="Main navigation">
      <a href="index.html">Home</a>
      <a href="booking-form.html">Book Service</a>
      <a href="admin.html">Admin Dashboard</a>
      <a href="contact.html">Contact</a>
    </nav>
  </header>

  <main class="container" role="main">
    <h2>Book Your Service</h2>
    <form id="bookingForm" novalidate>
      <label for="name">Full Name</label>
      <input type="text" id="name" name="name" required placeholder="Your full name" />

      <label for="phone">Phone Number</label>
      <input type="tel" id="phone" name="phone" required placeholder="e.g. 07712345678" />

      <label for="location">Your Location (GPS)</label>
      <input type="text" id="location" name="location" readonly required placeholder="Locating..." />

      <label for="extraAddress">Extra Details (House name/number)</label>
      <input type="text" id="extraAddress" name="extraAddress" placeholder="Add house name or number" />

      <label for="service">Select Service</label>
      <select id="service" name="service" required>
        <option value="">-- Choose Service --</option>
        <option value="Jumpstart">Jumpstart (£50)</option>
        <option value="Battery Fitting">Battery Fitting (£60)</option>
        <option value="Brake Replacement">Brake Replacement (£70)</option>
        <option value="Tyre Replacement">Tyre Replacement (£80)</option>
        <option value="Vehicle Diagnosis">Vehicle Diagnosis (£65)</option>
        <option value="Oil Change">Oil Change (£55)</option>
        <option value="Suspension Work">Suspension Work (£90)</option>
        <option value="Clutch Replacement">Clutch Replacement (£120)</option>
        <option value="Timing Belt">Timing Belt Replacement (£150)</option>
        <option value="Engine Repair">Engine Repair (£200)</option>
        <option value="Transmission Repair">Transmission Repair (£180)</option>
        <option value="AC Repair">AC Repair (£100)</option>
        <option value="Other">Other (Add notes)</option>
      </select>

      <label for="datetime">Preferred Date & Time</label>
      <input type="datetime-local" id="datetime" name="datetime" required />

      <label for="description">Job Description</label>
      <textarea id="description" name="description" placeholder="Anything extra? Tools needed?"></textarea>

      <!-- Estimated Cost Confirmation -->
      <div id="estimateConfirm" style="margin-top: 1.5rem; padding: 1rem; background: #fff3cd; border: 2px solid #ffb732; border-radius: 8px; font-weight: 900; font-size: 1.3rem; color: #d84315;">
        Please select a service to see the estimated cost.
      </div>

      <label style="display: flex; align-items: center; margin-top: 1rem; font-weight: 700; cursor: pointer;">
        <input type="checkbox" id="confirmEstimate" disabled style="margin-right: 0.6rem;" />
        I confirm I am happy with the estimated cost and want to proceed.
      </label>

      <div style="text-align: right; margin-top: 1rem;">
        <button type="button" id="disclaimerBtn" title="Terms">ℹ️</button>
      </div>

      <button type="submit" id="submitBtn" disabled style="margin-top: 1rem;">Confirm Booking</button>
    </form>
  </main>

  <script>
    // Hamburger menu toggle
    const menuBtn = document.getElementById('menuBtn');
    const dropdownMenu = document.getElementById('dropdownMenu');
    menuBtn.addEventListener('click', () => {
      dropdownMenu.classList.toggle('open');
    });
    menuBtn.addEventListener('keypress', e => {
      if(e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        dropdownMenu.classList.toggle('open');
      }
    });

    // Auto-get GPS location on page load
    const locationInput = document.getElementById('location');
    if ("geolocation" in navigator) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const { latitude, longitude } = position.coords;
          // Simple location display (can be enhanced with reverse geocoding)
          locationInput.value = `Lat: ${latitude.toFixed(4)}, Lon: ${longitude.toFixed(4)}`;
        },
        (error) => {
          locationInput.value = "Location access denied. Please enter manually.";
          locationInput.removeAttribute('readonly');
        },
        { enableHighAccuracy: true, timeout: 10000 }
      );
    } else {
      locationInput.value = "Geolocation not supported";
      locationInput.removeAttribute('readonly');
    }

    // Service estimated cost logic
    const serviceSelect = document.getElementById('service');
    const estimateConfirm = document.getElementById('estimateConfirm');
    const confirmCheckbox = document.getElementById('confirmEstimate');
    const submitBtn = document.getElementById('submitBtn');

    const servicePrices = {
      "Jumpstart": 50,
      "Battery Fitting": 60,
      "Brake Replacement": 70,
      "Tyre Replacement": 80,
      "Vehicle Diagnosis": 65,
      "Oil Change": 55,
      "Suspension Work": 90,
      "Clutch Replacement": 120,
      "Timing Belt": 150,
      "Engine Repair": 200,
      "Transmission Repair": 180,
      "AC Repair": 100,
      "Other": null,
    };

    serviceSelect.addEventListener('change', () => {
      const selectedService = serviceSelect.value;
      const price = servicePrices[selectedService];
      if (price) {
        estimateConfirm.textContent = `Estimated cost for ${selectedService}: £${price}. Please confirm you accept this price below.`;
        confirmCheckbox.disabled = false;
        confirmCheckbox.checked = false;
        submitBtn.disabled = true;
      } else if (selectedService === "Other") {
        estimateConfirm.textContent = "Please provide details for custom pricing.";
        confirmCheckbox.disabled = true;
        confirmCheckbox.checked = false;
        submitBtn.disabled = false;  // Allow submit for custom
      } else {
        estimateConfirm.textContent = "Please select a service to see the estimated cost.";
        confirmCheckbox.disabled = true;
        confirmCheckbox.checked = false;
        submitBtn.disabled = true;
      }
    });

    confirmCheckbox.addEventListener('change', () => {
      submitBtn.disabled = !confirmCheckbox.checked;
    });

    // Optional: Handle form submission (just demo)
    const bookingForm = document.getElementById('bookingForm');
    bookingForm.addEventListener('submit', e => {
      e.preventDefault();
      alert('Booking submitted! Thank you.');
      bookingForm.reset();
      estimateConfirm.textContent = "Please select a service to see the estimated cost.";
      confirmCheckbox.disabled = true;
      confirmCheckbox.checked = false;
      submitBtn.disabled = true;
      locationInput.value = "Locating...";
      // Re-trigger geolocation
      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const { latitude, longitude } = position.coords;
            locationInput.value = `Lat: ${latitude.toFixed(4)}, Lon: ${longitude.toFixed(4)}`;
          },
          () => {
            locationInput.value = "Location access denied. Please enter manually.";
            locationInput.removeAttribute('readonly');
          }
        );
      }
    });

  </script>
</body>
</html>