<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Auto-mec Booking Form</title>
  <style>
    /* === Color Variables === */
    :root {
      --hi-vis-orange: #ff7300;
      --hi-vis-yellow: #ffec3d;
      --white: #ffffff;
      --black: #000000;
      --gray-light: #f2f2f2;
      --gray-dark: #333333;
      --error-red: #c62828;
    }

    /* === Global base styles === */
    body {
      font-family: Arial, sans-serif;
      background: var(--white);
      margin: 0;
      padding: 1rem;
      color: var(--gray-dark);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container {
      max-width: 480px;
      margin: 0 auto;
    }

    /* === Header with hamburger menu === */
    header {
      background: var(--hi-vis-orange);
      color: var(--white);
      padding: 1rem;
      position: sticky;
      top: 0;
      z-index: 10000;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }

    #navToggle {
      background: none;
      border: none;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 22px;
      width: 28px;
      padding: 0;
    }

    #navToggle span {
      display: block;
      height: 4px;
      background: var(--white);
      border-radius: 2px;
    }

    nav#navMenu {
      position: absolute;
      top: 56px;
      right: 1rem;
      background: var(--hi-vis-orange);
      border-radius: 6px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      display: none;
      flex-direction: column;
      min-width: 150px;
      z-index: 10001;
    }

    nav#navMenu.show {
      display: flex;
    }

    nav#navMenu a {
      color: var(--white);
      padding: 0.75rem 1rem;
      text-decoration: none;
      font-weight: bold;
      border-bottom: 1px solid rgba(255,255,255,0.3);
    }

    nav#navMenu a:last-child {
      border-bottom: none;
    }

    nav#navMenu a:hover {
      background: var(--hi-vis-yellow);
      color: var(--black);
    }

    /* === Buttons === */
    .btn {
      display: block;
      width: 100%;
      padding: 20px;
      margin: 1rem 0;
      font-size: 1.1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      text-align: center;
      transition: background-color 0.3s ease;
    }

    .btn-primary {
      background-color: var(--hi-vis-orange);
      color: var(--white);
      font-weight: bold;
    }

    .btn-secondary {
      background-color: var(--hi-vis-yellow);
      color: var(--black);
      font-weight: bold;
      border: 2px solid var(--hi-vis-orange);
    }

    .btn-primary:hover {
      background-color: #e65f00;
    }

    .btn-secondary:hover {
      background-color: #fff55c;
    }

    /* === Form Inputs and Selects === */
    input[type="text"],
    input[type="date"],
    input[type="time"],
    select,
    textarea {
      width: 100%;
      padding: 20px;
      margin-top: 0.3rem;
      margin-bottom: 1rem;
      border: 2px solid var(--hi-vis-orange);
      border-radius: 6px;
      font-size: 1rem;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
      resize: vertical;
    }

    input[type="text"]:focus,
    input[type="date"]:focus,
    input[type="time"]:focus,
    select:focus,
    textarea:focus {
      border-color: var(--hi-vis-yellow);
      outline: none;
    }

    label {
      font-weight: bold;
      display: block;
      margin-top: 1rem;
    }

    /* === Info Button === */
    #infoBtn {
      background-color: var(--hi-vis-orange);
      color: var(--white);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      font-size: 1.2rem;
      line-height: 1;
      cursor: pointer;
      padding: 0;
      margin: 0.5rem 0 1rem 0;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      transition: background-color 0.3s ease;
    }

    #infoBtn:hover,
    #infoBtn:focus {
      background-color: #e65f00;
      outline: none;
    }

    /* === Modal popup styles === */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }

    .modal-content {
      background: var(--white);
      padding: 2rem;
      max-width: 320px;
      border-radius: 8px;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      font-size: 1rem;
    }

    .hidden {
      display: none !important;
    }

    .warning-text {
      color: var(--error-red);
      font-weight: bold;
    }

    /* === Responsive tweaks === */
    @media (min-width: 600px) {
      body {
        padding: 2rem;
      }
    }
  </style>
</head>
<body>

  <header>
    <h1>Auto-mec Booking</h1>
    <button id="navToggle" aria-label="Toggle navigation menu" aria-expanded="false" aria-controls="navMenu">
      <span></span><span></span><span></span>
    </button>
    <nav id="navMenu" aria-hidden="true">
      <a href="index.html">Home</a>
      <a href="booking-form.html">Book Service</a>
      <a href="admin.html">Admin Dashboard</a>
    </nav>
  </header>

  <main class="container">
    <form id="bookingForm" novalidate>
      <label for="serviceType">Service Type</label>
      <select id="serviceType" name="serviceType" required>
        <option value="" disabled selected>Select service</option>
        <option value="Tyre Change">Tyre Change</option>
        <option value="Battery Replacement">Battery Replacement</option>
        <option value="Engine Diagnostics">Engine Diagnostics</option>
        <option value="Breakdown Recovery">Breakdown Recovery</option>
      </select>

      <label for="serviceDate">Date</label>
      <input type="date" id="serviceDate" name="serviceDate" required />

      <label for="serviceTime">Time</label>
      <input type="time" id="serviceTime" name="serviceTime" required />

      <label for="address">Location (auto-detected by GPS)</label>
      <input type="text" id="address" name="address" placeholder="Use GPS to fill this" disabled required />

      <label for="extraDetail">House name/number or additional info</label>
      <input type="text" id="extraDetail" name="extraDetail" placeholder="Optional" disabled />

      <button type="button" id="gpsBtn" class="btn btn-primary" aria-label="Use my GPS to detect location">Use My GPS</button>

      <!-- Info button to open GPS info modal -->
      <button type="button" id="infoBtn" class="btn-secondary" aria-label="Show why GPS location is required">ℹ️</button>

      <label for="description">Service Description</label>
      <textarea id="description" name="description" rows="4" placeholder="Describe your problem or request..." required></textarea>

      <button type="submit" class="btn btn-primary">Submit Booking</button>
    </form>
  </main>

  <!-- GPS Info Modal -->
  <div id="gpsInfoModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="gpsInfoTitle" aria-describedby="gpsInfoDesc">
    <div class="modal-content">
      <h2 id="gpsInfoTitle">Why GPS Location is Required</h2>
      <p id="gpsInfoDesc">
        We use your location to send the nearest available mobile mechanic.<br />
        <strong class="warning-text">Bookings without GPS may be declined.</strong>
      </p>
      <button id="closeGpsInfo" class="btn btn-primary">Close</button>
    </div>
  </div>

  <!-- Confirmation Modal -->
  <div id="confirmationModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="confirmationTitle" aria-describedby="confirmationDesc">
    <div class="modal-content">
      <div id="confirmationText"></div>
      <button id="closeModal" class="btn btn-primary">Close</button>
    </div>
  </div>

  <script>
    // Hamburger menu toggle
    const navToggle = document.getElementById('navToggle');
    const navMenu = document.getElementById('navMenu');
    navToggle.addEventListener('click', () => {
      const expanded = navToggle.getAttribute('aria-expanded') === 'true' || false;
      navToggle.setAttribute('aria-expanded', !expanded);
      if (navMenu.classList.contains('show')) {
        navMenu.classList.remove('show');
        navMenu.setAttribute('aria-hidden', 'true');
      } else {
        navMenu.classList.add('show');
        navMenu.setAttribute('aria-hidden', 'false');
      }
    });

    // DOM elements for booking
    const gpsBtn = document.getElementById('gpsBtn');
    const addressInput = document.getElementById('address');
    const extraDetailInput = document.getElementById('extraDetail');
    const bookingForm = document.getElementById('bookingForm');
    const confirmationModal = document.getElementById('confirmationModal');
    const confirmationText = document.getElementById('confirmationText');
    const closeModalBtn = document.getElementById('closeModal');

    // Info modal elements
    const infoBtn = document.getElementById('infoBtn');
    const gpsInfoModal = document.getElementById('gpsInfoModal');
    const closeGpsInfo = document.getElementById('closeGpsInfo');

    // Disable form inputs except GPS and info buttons initially
    const formFields = bookingForm.querySelectorAll(
      'select, input:not(#address):not(#extraDetail):not(#gpsBtn):not(#infoBtn), textarea, button[type="submit"]'
    );
    formFields.forEach(el => el.disabled = true);
    addressInput.disabled = true;
    extraDetailInput.disabled = true;

    // GPS button click - get location
    gpsBtn.addEventListener('click', () => {
      if (!navigator.geolocation) {
        alert('Geolocation is not supported by your browser.');
        return;
      }

      gpsBtn.textContent = 'Locating...';
      gpsBtn.disabled = true;

      navigator.geolocation.getCurrentPosition(
        (position) => {
          const { latitude, longitude } = position.coords;

          // Reverse geocode OpenStreetMap Nominatim API
          fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}`)
            .then(response => response.json())
            .then(data => {
              let road = data.address?.road || data.address?.pedestrian || '';
              let postcode = data.address?.postcode || '';
              let displayAddress = road ? `${road}, ${postcode}` : data.display_name || '';

              addressInput.value = displayAddress;
              addressInput.disabled = false;
              extraDetailInput.disabled = false;
              formFields.forEach(el => el.disabled = false);

              gpsBtn.textContent = 'Use My GPS';
              gpsBtn.disabled = false;
            })
            .catch(() => {
              alert('Unable to retrieve your address from GPS coordinates.');
              gpsBtn.textContent = 'Use My GPS';
              gpsBtn.disabled = false;
            });
        },
        () => {
          alert('Failed to get your location. Please allow location access to continue.');
          gpsBtn.textContent = 'Use My GPS';
          gpsBtn.disabled = false;
        }
      );
    });

    // Booking form submission
    bookingForm.addEventListener('submit', (e) => {
      e.preventDefault();

      if (addressInput.disabled || !addressInput.value.trim()) {
        alert('Location is required. Please use the "Use My GPS" button first.');
        return;
      }

      if (!bookingForm.checkValidity()) {
        bookingForm.reportValidity();
        return;
      }

      const formData = new FormData(bookingForm);
      const data = Object.fromEntries(formData.entries());

      const reference = 'AUC' + Math.floor(Math.random() * 900 + 100);
      const fullLocation = data.address + (data.extraDetail ? ' - ' + data.extraDetail : '');

      confirmationText.innerHTML = `
        <h2 id="confirmationTitle">✅ Booking Confirmed!</h2>
        <p>🧾 <strong>Booking Reference:</strong> #${reference}</p>
        <p>🔧 <strong>Service Type:</strong> ${data.serviceType}</p>
        <p>🗓 <strong>Date:</strong> ${data.serviceDate}</p>
        <p>⏰ <strong>Time:</strong> ${data.serviceTime}</p>
        <p>📍 <strong>Location:</strong> ${fullLocation}</p>
        <br />
        <p>☎️ Our team will contact you shortly.</p>
        <p>📸 Please take a screenshot or save this confirmation.</p>
      `;

      confirmationModal.classList.remove('hidden');

      // Reset and disable inputs except GPS/info buttons
      bookingForm.reset();
      formFields.forEach(el => el.disabled = true);
      addressInput.disabled = true;
      extraDetailInput.disabled = true;
    });

    // Close confirmation modal
    closeModalBtn.addEventListener('click', () => {
      confirmationModal.classList.add('hidden');
    });

    // Open GPS info modal
    infoBtn.addEventListener('click', () => {
      gpsInfoModal.classList.remove('hidden');
    });

    // Close GPS info modal
    closeGpsInfo.addEventListener('click', () => {
      gpsInfoModal.classList.add('hidden');
    });

    // Close GPS info modal if clicking outside modal content
    gpsInfoModal.addEventListener('click', (e) => {
      if (e.target === gpsInfoModal) {
        gpsInfoModal.classList.add('hidden');
      }
    });
  </script>
</body>
</html>