<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Auto-mec - Booking Form</title>
  <link rel="stylesheet" href="../styles.css" />
</head>
<body>

  <!-- Header placeholder -->
  <header id="siteHeader"></header>

  <main class="container">
    <h1>Book a Service</h1>
    <form id="bookingForm" autocomplete="off">
      <label for="serviceType">Service Type</label>
      <select id="serviceType" name="serviceType" required>
        <option value="" disabled selected>Select a service</option>
        <option value="oilChange">Oil Change</option>
        <option value="brakeService">Brake Service</option>
        <option value="engineCheck">Engine Check</option>
        <option value="tyreReplacement">Tyre Replacement</option>
      </select>

      <label for="serviceDate">Date</label>
      <input type="date" id="serviceDate" name="serviceDate" required />

      <label for="serviceTime">Time</label>
      <input type="time" id="serviceTime" name="serviceTime" required />

      <label for="description">Description / Notes</label>
      <textarea id="description" name="description" rows="4" placeholder="Additional details..."></textarea>

      <label>Location</label>
      <button type="button" class="btn-secondary" id="gpsBtn">Use My GPS</button>
      <input
        type="text"
        id="address"
        name="address"
        placeholder="Or enter address manually"
        required
      />

      <button type="submit" class="btn btn-primary">Submit Booking</button>
    </form>

    <div id="confirmation" class="hidden"></div>
  </main>

  <script>
    // Load header and setup hamburger toggle
    fetch('../shared/header.html')
      .then(res => res.text())
      .then(data => {
        document.getElementById('siteHeader').innerHTML = data;
        const toggle = document.getElementById('navToggle');
        const menu = document.getElementById('navMenu');
        if (toggle && menu) {
          toggle.addEventListener('click', () => {
            menu.classList.toggle('show');
          });
        }
      });

    // GPS button functionality
    const gpsBtn = document.getElementById('gpsBtn');
    const addressInput = document.getElementById('address');

    gpsBtn.addEventListener('click', () => {
      if (!navigator.geolocation) {
        alert('Geolocation is not supported by your browser');
        return;
      }

      gpsBtn.textContent = 'Locating...';
      gpsBtn.disabled = true;

      navigator.geolocation.getCurrentPosition(
        (position) => {
          const { latitude, longitude } = position.coords;
          // Use reverse geocoding API to get address from lat/lon
          // Using OpenStreetMap Nominatim API (free)
          fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}`)
            .then(response => response.json())
            .then(data => {
              addressInput.value = data.display_name || '';
              gpsBtn.textContent = 'Use My GPS';
              gpsBtn.disabled = false;
            })
            .catch(() => {
              alert('Unable to retrieve address from GPS');
              gpsBtn.textContent = 'Use My GPS';
              gpsBtn.disabled = false;
            });
        },
        (error) => {
          alert('Unable to retrieve your location');
          gpsBtn.textContent = 'Use My GPS';
          gpsBtn.disabled = false;
        }
      );
    });

    // Form submission handling
    const form = document.getElementById('bookingForm');
    const confirmation = document.getElementById('confirmation');

    form.addEventListener('submit', (e) => {
      e.preventDefault();

      // Simple form validation can be enhanced
      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const formData = new FormData(form);
      const bookingData = Object.fromEntries(formData.entries());

      // Here you would send bookingData to your backend API
      // For demo, just show confirmation message

      confirmation.textContent = `Thank you! Your booking for ${bookingData.serviceType} on ${bookingData.serviceDate} at ${bookingData.serviceTime} has been received. We will contact you at the provided address.`;
      confirmation.classList.remove('hidden');

      form.reset();
    });
  </script>
</body>
</html>